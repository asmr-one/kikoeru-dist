(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[15],{"09ef":function(e,s,t){"use strict";t.r(s);var a=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",[t("q-card",{staticClass:"q-ma-md"},[t("q-form",{on:{submit:function(s){return e.updateAdminPassword()}}},[t("q-toolbar",[t("q-toolbar-title",[e._v("修改管理员密码")])],1),t("div",{staticClass:"q-pa-sm"},[t("q-input",{attrs:{outlined:"",dense:"",type:"password",label:"新密码","lazy-rules":"",rules:[function(e){return e.length>=5||"密码长度至少为 5"}]},model:{value:e.adminNewPassword,callback:function(s){e.adminNewPassword=s},expression:"adminNewPassword"}}),t("q-input",{attrs:{outlined:"",dense:"",type:"password",label:"确认密码","lazy-rules":"",rules:[function(e){return e.length>=5||"密码长度至少为 5"},function(s){return s===e.adminNewPassword||"两次密码输入不一致"}]},model:{value:e.adminConfirmPassword,callback:function(s){e.adminConfirmPassword=s},expression:"adminConfirmPassword"}}),t("div",{staticClass:"row justify-end"},[t("q-btn",{attrs:{loading:e.loadingUpdateAdminPassword,type:"submit",color:"primary",label:"修改"}})],1)],1)],1)],1),t("q-card",{staticClass:"q-ma-md"},[t("q-form",{on:{submit:function(s){return e.addNewUser()}}},[t("q-toolbar",[t("q-toolbar-title",[e._v("添加新用户")])],1),t("div",{staticClass:"q-pa-sm"},[t("q-select",{staticClass:"q-mb-md",attrs:{dense:"",outlined:"",label:"用户组",options:e.groups},model:{value:e.newuser.group,callback:function(s){e.$set(e.newuser,"group",s)},expression:"newuser.group"}}),t("q-input",{attrs:{outlined:"",dense:"",label:"用户名",required:"","lazy-rules":"",rules:[function(e){return e.length>=5||"用户名长度至少为 5"},function(s){return!e.users.find((function(e){return e.name===s}))||"该名称已存在，用户名不能重复"}]},model:{value:e.newuser.name,callback:function(s){e.$set(e.newuser,"name",s)},expression:"newuser.name"}}),t("q-input",{attrs:{outlined:"",dense:"",label:"密码","lazy-rules":"",rules:[function(e){return e.length>=5||"密码长度至少为 5"}]},model:{value:e.newuser.password,callback:function(s){e.$set(e.newuser,"password",s)},expression:"newuser.password"}}),t("div",{staticClass:"row justify-end"},[t("q-btn",{attrs:{loading:e.loadingAddNewUser,type:"submit",color:"primary",label:"添加"}})],1)],1)],1)],1),t("q-card",{staticClass:"q-ma-md q-pa-sm"},[t("q-table",{attrs:{title:"所有用户",data:e.users,columns:e.columns,"row-key":"name","selected-rows-label":e.getSelectedString,selection:"multiple",selected:e.selected},on:{"update:selected":function(s){e.selected=s}}}),t("div",{staticClass:"row justify-end"},[t("q-btn",{attrs:{loading:e.loadingDeleteUsers,disable:0===e.selected.length,color:"primary",label:"删除"},on:{click:function(s){e.confirm=!0}}})],1)],1),t("q-dialog",{attrs:{persistent:""},model:{value:e.confirm,callback:function(s){e.confirm=s},expression:"confirm"}},[t("q-card",[t("q-card-section",{staticClass:"row items-center"},[t("span",{staticClass:"q-ma-sm text-h6"},[e._v("确认删除选中用户？")])]),t("q-card-actions",{attrs:{align:"right"}},[t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消",color:"primary"}}),t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"确认",color:"primary"},on:{click:function(s){return e.deleteUsers()}}})],1)],1)],1)],1)},r=[],o=t("2d97"),n={mixins:[o["a"]],data(){return{selected:[],columns:[{name:"desc",required:!0,label:"用户名",align:"left",field:"name",sortable:!0},{name:"calories",required:!0,label:"用户组",align:"center",field:"group",sortable:!0}],users:[],loadingDeleteUsers:!1,newuser:{name:"",password:"",group:"user"},groups:["user","guest"],loadingAddNewUser:!1,adminNewPassword:"",adminConfirmPassword:"",loadingUpdateAdminPassword:!1,confirm:!1}},methods:{getSelectedString(){return 0===this.selected.length?"":`${this.selected.length} record${this.selected.length>1?"s":""} selected of ${this.users.length}`},addNewUser(){this.loadingAddNewUser=!0,this.$axios.post("/api/credentials/user",{name:this.newuser.name,password:this.newuser.password,group:this.newuser.group}).then(e=>{this.users.push(this.newuser),this.loadingAddNewUser=!1,this.showSuccNotif(e.data.message),this.requestUsers()}).catch(e=>{this.loadingAddNewUser=!1,422===e.response.status?this.showErrNotif(e.response.data.errors[0].msg):403===e.response.status?this.showWarnNotif(e.response.data.error):this.showErrNotif(e.response.data.error||`${e.response.status} ${e.response.statusText}`)})},deleteUsers(){this.loadingDeleteUsers=!0,this.$axios.delete("/api/credentials/user",{data:{users:this.selected}}).then(e=>{this.selected.forEach(e=>{const s=this.users.findIndex(s=>s.name===e.name);this.users.splice(s,1)}),this.loadingDeleteUsers=!1,this.showSuccNotif(e.data.message),this.requestUsers()}).catch(e=>{this.loadingDeleteUsers=!1,e.response?403===e.response.status?this.showWarnNotif(e.response.data.error):this.showErrNotif(e.response.data.error||`${e.response.status} ${e.response.statusText}`):this.showErrNotif(e.message||e)})},updateAdminPassword(){this.loadingUpdateAdminPassword=!0,this.$axios.put("/api/credentials/user",{name:"admin",newPassword:this.adminNewPassword}).then(e=>{this.loadingUpdateAdminPassword=!1;try{this.$q.localStorage.set("jwt-token","")}catch(s){this.showErrNotif(s.message)}this.showSuccNotif(e.data.message),this.$store.state.User.auth&&(console.log("Got here"),this.$router.push("/login"))}).catch(e=>{this.loadingUpdateAdminPassword=!1,e.response?this.showErrNotif(e.response.data.error||`${e.response.status} ${e.response.statusText}`):this.showErrNotif(e.message||e)})},requestUsers(){this.$axios.get("/api/credentials/users").then(e=>{this.users=e.data.users}).catch(e=>{e.response?401!==e.response.status&&this.showErrNotif(e.response.data.error||`${e.response.status} ${e.response.statusText}`):this.showErrNotif(e.message||e)})}},created(){this.requestUsers()}},i=n,l=t("2877"),d=t("f09f"),u=t("0378"),c=t("65c6"),p=t("6ac5"),m=t("27f9"),h=t("9c40"),w=t("ddd8"),f=t("eaac"),g=t("24e8"),b=t("a370"),q=t("4b7e"),N=t("7f67"),U=t("eebe"),v=t.n(U),$=Object(l["a"])(i,a,r,!1,null,null,null);s["default"]=$.exports;v()($,"components",{QCard:d["a"],QForm:u["a"],QToolbar:c["a"],QToolbarTitle:p["a"],QInput:m["a"],QBtn:h["a"],QSelect:w["a"],QTable:f["a"],QDialog:g["a"],QCardSection:b["a"],QCardActions:q["a"]}),v()($,"directives",{ClosePopup:N["a"]})}}]);
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{0:function(t,e,a){t.exports=a("2f39")},"06e0":function(t,e,a){},"104d":function(t,e){},"1f5a":function(t,e,a){"use strict";var s=a("8e3b"),r=a.n(s);r.a},"2d97":function(t,e,a){"use strict";e["a"]={methods:{showSuccNotif(t){this.$q.notify({message:t,color:"positive",icon:"done",timeout:500})},showWarnNotif(t){this.$q.notify({message:t,color:"warning",icon:"warning"})},showErrNotif(t){this.$q.notify({message:t,color:"negative",icon:"bug_report"})}}}},"2f39":function(t,e,a){"use strict";a.r(e);a("7d6e"),a("e54f"),a("985d"),a("31cd");var s=a("2b0e"),r=a("1f91"),i=a("42d2"),o=a("b05d"),n=a("18d6"),l=a("a639"),c=a("2a19");s["a"].use(o["a"],{config:{},lang:r["a"],iconSet:i["a"],plugins:{LocalStorage:n["a"],SessionStorage:l["a"],Notify:c["a"]}});var d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"q-app"}},[a("router-view")],1)},u=[],p={name:"App"},m=p,h=a("2877"),g=Object(h["a"])(m,d,u,!1,null,null,null),w=g.exports,v=a("e6b1"),f=function(){return{hide:!1,wantPlaying:!1,playing:!1,currentTime:0,duration:0,source:"",queue:[],queueIndex:0,playMode:{id:0,name:"order"},muted:!1,volume:0,currentLyric:"",sleepTime:null,sleepMode:!1,rewindSeekTime:5,forwardSeekTime:30,rewindSeekMode:!1,forwardSeekMode:!1,lyricContent:"",shouldLoadPlayer:!1}};const b={currentPlayingFile:t=>t.queue[t.queueIndex]||{hash:"",title:"",workTitle:"",mediaStreamUrl:"",mediaDownloadUrl:"",samCoverUrl:"",thumbnailCoverUrl:"",mainCoverUrl:""}};var q=b;const _={TOGGLE_HIDE(t){t.hide=!t.hide},LOAD_PLAYER(t){t.shouldLoadPlayer=!0},WANT_PLAY(t){t.wantPlaying=!0},WANT_PAUSE(t){t.wantPlaying=!1},TOGGLE_WANT_PLAYING(t){t.wantPlaying=!t.playing},ON_PLAY(t){t.playing=!0},ON_PAUSE(t){t.playing=!1},SET_TRACK:(t,e)=>{e>=t.queue.length||e<0||(t.wantPlaying=!0,t.queueIndex=e)},NEXT_TRACK:t=>{t.queueIndex<t.queue.length-1&&(t.wantPlaying=!0,t.queueIndex+=1)},PREVIOUS_TRACK:t=>{t.queueIndex>0&&(t.wantPlaying=!0,t.queueIndex-=1)},SET_QUEUE(t,e){t.queue=e.queue,t.queueIndex=e.index,e.resetPlaying&&(t.wantPlaying=!0)},EMPTY_QUEUE:t=>{t.wantPlaying=!1,t.queue=[],t.queueIndex=0},ADD_TO_QUEUE:(t,e)=>{t.queue.push(e)},REMOVE_FROM_QUEUE:(t,e)=>{t.queue.splice(e,1),e===t.queueIndex?(t.playing=!1,t.wantPlaying=!1,t.queueIndex=0):e<t.queueIndex&&(t.queueIndex-=1)},SET_DURATION(t,e){t.duration=e},SET_CURRENT_TIME(t,e){t.currentTime=e},PLAY_NEXT:(t,e)=>{t.queue.splice(t.queueIndex+1,0,e)},CHANGE_PLAY_MODE:t=>{const e=[{id:0,name:"order"},{id:1,name:"all repeat"},{id:2,name:"repeat once"},{id:3,name:"shuffle"}],a=t.playMode.id>=e.length-1?0:t.playMode.id+1;t.playMode=e[a]},TOGGLE_MUTED:t=>{t.muted=!t.muted},SET_VOLUME:(t,e)=>{e<0||e>1||(t.volume=e)},SET_REWIND_SEEK_TIME:(t,e)=>{t.rewindSeekTime=e},SET_FORWARD_SEEK_TIME:(t,e)=>{t.forwardSeekTime=e},SET_REWIND_SEEK_MODE:(t,e)=>{t.rewindSeekMode=e},SET_FORWARD_SEEK_MODE:(t,e)=>{t.forwardSeekMode=e},SET_CURRENT_LYRIC:(t,e)=>{t.currentLyric=e},SET_SLEEP_TIMER:(t,e)=>{t.sleepTime=e,t.sleepMode=!0},CLEAR_SLEEP_MODE:t=>{t.sleepTime=null,t.sleepMode=!1},SET_LYRIC_CONTENT:(t,e)=>{t.lyricContent=e}};var k=_,x=a("6a18"),y={namespaced:!0,getters:q,mutations:k,actions:x,state:f},C=function(){return{auth:!1,name:"",group:"",reg:!1}},S=a("b5fb");const E={INIT(t,e){t.name=e.name,t.group=e.group},SET_AUTH(t,e){t.auth=e},SET_REG(t,e){t.reg=e}};var $=E,T=a("104d"),N={namespaced:!0,state:C,getters:S,mutations:$,actions:T};s["a"].use(v["a"]);var I=function(){const t=new v["a"].Store({modules:{AudioPlayer:y,User:N},strict:!1});return t},P=a("8c4f"),R=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-layout",{class:""+(!this.$q.dark.isActive&&"bg-grey-3"),attrs:{view:"hHh Lpr lFf"}},[a("q-header",{staticClass:"shadow-4"},[a("q-toolbar",{staticClass:"row justify-between",class:t.$q.dark.isActive&&"bg-dark"},[a("q-btn",{attrs:{flat:"",dense:"",round:"",icon:"menu","aria-label":"Menu"},on:{click:function(e){t.drawerOpen=!t.drawerOpen}}}),t.isNotAtHomePage?a("q-btn",{attrs:{flat:"",size:"md",icon:"arrow_back_ios"},on:{click:function(e){return t.back()}}}):t._e(),a("q-toolbar-title",{staticClass:"gt-xs"},[a("router-link",{staticClass:"text-white",attrs:{to:"/"}},[t._v("\n            Kikoeru\n          ")])],1),a("q-input",{staticClass:"q-mr-sm",attrs:{dark:"",dense:"",rounded:"",standout:"",debounce:"500","input-class":"text-right"},scopedSlots:t._u([{key:"append",fn:function(){return[""===t.keyword?a("q-icon",{attrs:{name:"search"}}):a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"clear"},on:{click:function(e){t.keyword=""}}})]},proxy:!0}]),model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}})],1),t.shouldLoadPlayer?a("AudioPlayer"):t._e()],1),a("q-drawer",{attrs:{"show-if-above":"",mini:t.miniState,"mini-to-overlay":"",width:230,breakpoint:500,bordered:"","content-class":""+(!this.$q.dark.isActive&&"bg-grey-1")},on:{mouseover:function(e){t.miniState=!1},mouseout:function(e){t.miniState=!0}},model:{value:t.drawerOpen,callback:function(e){t.drawerOpen=e},expression:"drawerOpen"}},[a("q-scroll-area",{staticClass:"fit"},[a("q-list",[t._l(t.links,(function(e,s){return a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:s,attrs:{clickable:"",exact:"",to:e.path,"active-class":"text-deep-purple text-weight-medium"},on:{click:function(e){t.miniState=!0}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:e.icon}})],1),a("q-item-section",[a("q-item-label",{staticClass:"text-subtitle1"},[t._v("\n                "+t._s(e.title)+"\n              ")])],1)],1)})),a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:"",exact:"","active-class":"text-deep-purple text-weight-medium"},on:{click:t.randomPlay}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:"shuffle"}})],1),a("q-item-section",[a("q-item-label",{staticClass:"text-subtitle1"},[t._v("\n                随心听\n              ")])],1)],1),a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:"",exact:"","active-class":"text-deep-purple text-weight-medium"},on:{click:function(e){t.showTimer=!0}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:"bedtime"}})],1),a("q-item-section",[a("q-item-label",{staticClass:"text-subtitle1"},[t._v("\n                睡眠模式\n              ")])],1)],1)],2),a("q-list",[a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:"",exact:"","active-class":"text-deep-purple text-weight-medium"},on:{click:function(e){return t.$q.dark.toggle()}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:this.$q.dark.isActive?"wb_sunny":"nights_stay"}})],1),a("q-item-section",[a("q-item-label",{staticClass:"text-subtitle1"},[t._v("\n                黑暗模式\n              ")])],1)],1),a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:"",exact:"",to:"/about","active-class":"text-deep-purple text-weight-medium"},on:{click:function(e){t.miniState=!0}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:"info"}})],1),a("q-item-section",[a("q-item-label",{staticClass:"text-subtitle1"},[t._v("\n                关于 About\n              ")])],1)],1),"administrator"===this.$store.state.User.group?a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:"",exact:"",to:"/admin","active-class":"text-deep-purple text-weight-medium"},on:{click:function(e){t.miniState=!0}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:"tune"}})],1),a("q-item-section",[a("q-item-label",{staticClass:"text-subtitle1"},[t._v("\n                设定\n              ")])],1)],1):t._e(),t.authEnabled?a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:"",exact:"","active-class":"text-deep-purple text-weight-medium"},on:{click:function(e){t.confirm=!0}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:"exit_to_app"}})],1),a("q-item-section",[a("q-item-label",{staticClass:"text-subtitle1"},[t._v("\n                登出\n              ")]),a("q-item-label",{attrs:{caption:"",lines:"2"}},[t._v(t._s(t.userName))])],1)],1):t._e()],1)],1)],1),a("q-dialog",{attrs:{persistent:""},model:{value:t.confirm,callback:function(e){t.confirm=e},expression:"confirm"}},[a("q-card",[a("q-card-section",{staticClass:"row items-center"},[a("q-avatar",{attrs:{icon:"power_settings_new",color:"primary","text-color":"white"}}),a("span",{staticClass:"q-ml-sm"},[t._v("是否退出登录？（若未开启用户验证，则操作无效）")])],1),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消",color:"primary"}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"退出",color:"primary"},on:{click:function(e){return t.logout()}}})],1)],1)],1),a("SleepMode",{model:{value:t.showTimer,callback:function(e){t.showTimer=e},expression:"showTimer"}}),a("q-page-container",[a("keep-alive",{attrs:{include:"Works"}},[a("router-view")],1),a("q-page-scroller",{attrs:{position:"bottom-right","scroll-offset":150,offset:[18,18],id:"gotop"}},[a("q-btn",{attrs:{fab:"",icon:"keyboard_arrow_up",color:"accent"}})],1)],1),a("q-footer",{staticClass:"q-pa-none"},[t.shouldLoadPlayer?a("LyricsBar"):t._e(),t.shouldLoadPlayer?a("PlayerBar"):t._e()],1)],1)},Q=[],O=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-dialog",{attrs:{value:t.value,persistent:""},on:{input:function(e){return t.$emit("input")}}},[a("q-card",[a("div",{staticClass:"q-pa-sm"},[a("q-time",{attrs:{"now-btn":"",dark:t.sleepMode},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}})],1),a("div",{staticClass:"row justify-between"},[a("q-card-actions",[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消定时",color:"primary",disable:!t.sleepMode},on:{click:t.clearSleepTimer}})],1),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消",color:"primary"}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"确定",color:"primary"},on:{click:t.setSleepTimer}})],1)],1)])],1)},M=[],U={name:"SleepMode",props:["value"],data(){return{time:"00:00"}},computed:{...Object(v["d"])("AudioPlayer",["sleepTime","sleepMode"])},mounted(){try{this.$q.sessionStorage.getItem("sleepMode")&&this.SET_SLEEP_TIMER(this.$q.sessionStorage.getItem("sleepTime"))}catch{console.log("Web Storage API error")}},watch:{value(t){if(t)if(this.sleepMode)this.time=this.sleepTime;else{const t=new Date;this.time=t.getHours().toString().padStart(2,"0")+":"+t.getMinutes().toString().padStart(2,"0")}}},methods:{...Object(v["c"])("AudioPlayer",["SET_SLEEP_TIMER","CLEAR_SLEEP_MODE"]),setSleepTimer(){this.SET_SLEEP_TIMER(this.time);try{this.$q.sessionStorage.set("sleepTime",this.time),this.$q.sessionStorage.set("sleepMode",!0)}catch{console.log("Web Storage API error")}this.showSuccNotif(`将于${this.time}停止播放`)},clearSleepTimer(){this.CLEAR_SLEEP_MODE();try{this.$q.sessionStorage.set("sleepTime",null),this.$q.sessionStorage.set("sleepMode",!1)}catch{console.log("Web Storage API error")}this.showSuccNotif("已关闭睡眠模式")},showSuccNotif(t){this.$q.notify({message:t,color:"primary",icon:"bedtime",timeout:5e3})}}},A=U,L=a("24e8"),D=a("f09f"),j=a("ca78"),W=a("4b7e"),F=a("9c40"),B=a("7f67"),z=a("eebe"),G=a.n(z),J=Object(h["a"])(A,O,M,!1,null,null,null),K=J.exports;G()(J,"components",{QDialog:L["a"],QCard:D["a"],QTime:j["a"],QCardActions:W["a"],QBtn:F["a"]}),G()(J,"directives",{ClosePopup:B["a"]});var Y=a("2d97"),H=a("9224"),V=a("b06b"),X={computed:{changelogUrl(){return"https://blog.asmr.one/frontend-"+H["b"].replace(".","-")}},methods:{notifyUpdate(t){this.$q.notify({message:"新版本发布！",caption:"v"+t,color:"positive",icon:"done",timeout:1e4,multiLine:!1,actions:[{label:"忽略",color:"white"},{label:"查看",color:"yellow",handler:()=>{Object(V["a"])(this.changelogUrl)}}]})},hasUpdate(t,e){let a=t.split(".").slice(0,-1).join("."),s=e.split(".").slice(0,-1).join(".");return a!==s},doUpdate(t){this.$q.localStorage.set("localVersion",t)}},mounted(){let t=this.$q.localStorage.getItem("localVersion");t&&!this.hasUpdate(t,H["b"])||(this.notifyUpdate(H["b"]),this.doUpdate(H["b"]))}},Z={name:"MainLayout",mixins:[Y["a"],X],components:{PlayerBar:()=>Promise.all([a.e(1),a.e(11)]).then(a.bind(null,"55e9")),AudioPlayer:()=>Promise.all([a.e(1),a.e(5)]).then(a.bind(null,"7901")),LyricsBar:()=>a.e(6).then(a.bind(null,"4764")),SleepMode:K},data(){return{keyword:"",drawerOpen:!1,miniState:!0,confirm:!1,randId:null,showTimer:!1,links:[{title:"媒体库",icon:"widgets",path:"/"},{title:"我的收藏",icon:"favorite",path:"/favourites"},{title:"社团",icon:"group",path:"/circles"},{title:"标签",icon:"label",path:"/tags"},{title:"声优",icon:"mic",path:"/vas"}],sharedConfig:{}}},watch:{"$q.dark.isActive"(t){this.$q.localStorage.set("dark",t)},keyword(){this.$router.push(this.keyword?"/works?keyword="+this.keyword:"/works")},randId(){this.$router.push("/work/"+this.randId)},sharedConfig(t){this.SET_REWIND_SEEK_TIME(t.rewindSeekTime),this.SET_FORWARD_SEEK_TIME(t.forwardSeekTime)}},mounted(){this.initUser(),this.checkUpdate(),this.readSharedConfig(),this.$q.localStorage.has("dark")&&this.$q.localStorage.getItem("dark")&&this.$q.dark.set(!0)},computed:{isNotAtHomePage(){const t=this.$route.path;return t&&"/"!==t&&"/works"!==t&&"/favourites"!==t},...Object(v["d"])("User",{userName:"name",authEnabled:"auth"}),...Object(v["d"])("AudioPlayer",["shouldLoadPlayer"])},methods:{...Object(v["c"])("AudioPlayer",["SET_REWIND_SEEK_TIME","SET_FORWARD_SEEK_TIME"]),initUser(){this.$axios.get("/api/auth/me").then(t=>{this.$store.commit("User/INIT",t.data.user),this.$store.commit("User/SET_AUTH",t.data.auth),this.$store.commit("User/SET_REG",t.data.reg)}).catch(t=>{if(t.response)if(401===t.response.status){const t=this.$router.currentRoute.path;"/login"!==t&&this.$router.push("/login")}else this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`);else this.showErrNotif(t.message||t)})},checkUpdate(){this.$axios.get("/api/version").then(t=>{t.data.update_available&&t.data.notifyUser&&this.$q.notify({message:"GitHub上有新版本",color:"primary",textColor:"white",icon:"cloud_download",timeout:5e3,actions:[{label:"好",color:"white"},{label:"查看",color:"white",handler:()=>{Object.assign(document.createElement("a"),{target:"_blank",href:"https://github.com/umonaca/kikoeru-express/releases"}).click()}}]}),t.data.lockFileExists&&this.$q.notify({message:t.data.lockReason,type:"warning",timeout:6e4,actions:[{label:"以后提醒我",color:"black"},{label:"前往扫描页",color:"black",handler:()=>this.$router.push("/admin/scanner")}]})}).catch(t=>{console.error(t)})},readSharedConfig(){this.$axios.get("/api/config/shared").then(t=>{this.sharedConfig=t.data.sharedConfig}).catch(t=>{if(t.response)if(401===t.response.status){const t=this.$router.currentRoute.path;"/login"!==t&&this.$router.push("/login")}else this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`);else this.showErrNotif(t.message||t)})},randomPlay(){this.requestRandomWork()},requestRandomWork(){const t={order:"betterRandom"};this.$axios.get("/api/works",{params:t}).then(t=>{const e=t.data.works;this.randId=e.length?e[0].id:null}).catch(t=>{t.response?401!==t.response.status&&this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})},logout(){this.$q.localStorage.set("jwt-token",""),this.$router.push("/login")},back(){this.$router.go(-1)}}},tt=Z,et=(a("89d3"),a("4d5a")),at=a("e359"),st=a("65c6"),rt=a("6ac5"),it=a("27f9"),ot=a("0016"),nt=a("9404"),lt=a("4983"),ct=a("1c1c"),dt=a("66e5"),ut=a("4074"),pt=a("0170"),mt=a("a370"),ht=a("cb32"),gt=a("09e3"),wt=a("9989"),vt=a("5096"),ft=a("7ff0"),bt=a("714f"),qt=Object(h["a"])(tt,R,Q,!1,null,null,null),_t=qt.exports;G()(qt,"components",{QLayout:et["a"],QHeader:at["a"],QToolbar:st["a"],QBtn:F["a"],QToolbarTitle:rt["a"],QInput:it["a"],QIcon:ot["a"],QDrawer:nt["a"],QScrollArea:lt["a"],QList:ct["a"],QItem:dt["a"],QItemSection:ut["a"],QItemLabel:pt["a"],QDialog:L["a"],QCard:D["a"],QCardSection:mt["a"],QAvatar:ht["a"],QCardActions:W["a"],QPageContainer:gt["a"],QPage:wt["a"],QPageScroller:vt["a"],QFooter:ft["a"]}),G()(qt,"directives",{Ripple:bt["a"],ClosePopup:B["a"]});var kt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"text-h5 text-weight-regular q-ma-md"},[t._v("\n    "+t._s(t.pageTitle)+"\n    "),a("span",{directives:[{name:"show",rawName:"v-show",value:t.pagination.totalCount,expression:"pagination.totalCount"}]},[t._v("\n      ("+t._s(t.pagination.totalCount)+")\n    ")])]),a("div",{class:"row justify-center "+("list"===t.displayMode?"list":"q-mx-md")},[a("q-page",{staticClass:"col"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.works.length,expression:"works.length"}],staticClass:"row justify-between q-mb-md q-mr-sm"},[a("q-select",{staticClass:"col-auto",attrs:{dense:"",rounded:"",outlined:"","bg-color":t.color,"transition-show":"scale","transition-hide":"scale",options:t.options,label:"排序"},model:{value:t.sortOption,callback:function(e){t.sortOption=e},expression:"sortOption"}}),a("q-checkbox",{staticClass:"row",attrs:{label:"带字幕"},model:{value:t.subtitleOnly,callback:function(e){t.subtitleOnly=e},expression:"subtitleOnly"}}),a("q-btn-toggle",{staticClass:"col-auto",staticStyle:{width:"85px"},attrs:{dense:"",spread:"",rounded:"","toggle-color":"primary",color:"white","text-color":"primary",options:[{icon:"view_module",value:"thumbnail"},{icon:"view_column",value:"detail"},{icon:"list",value:"list"}]},model:{value:t.displayMode,callback:function(e){t.displayMode=e},expression:"displayMode"}})],1),"list"===t.displayMode?a("q-list",{staticClass:"shadow-2",attrs:{bordered:"",separator:""}},t._l(t.works,(function(t){return a("WorkListItem",{key:t.id,attrs:{metadata:t,showLabel:!0}})})),1):a("div",{staticClass:"row q-col-gutter-x-md q-col-gutter-y-lg"},t._l(t.works,(function(e){return a("div",{key:e.id,staticClass:"col-xs-12 col-sm-6 col-md-4",class:"detail"===t.displayMode?"col-lg-3 col-xl-2":"col-lg-2 col-xl-2"},[a("WorkCard",{staticClass:"fit",attrs:{metadata:e,thumbnailMode:"thumbnail"===t.displayMode}})],1)})),0),a("div",{directives:[{name:"show",rawName:"v-show",value:t.stopLoad&&0===t.maxPage,expression:"stopLoad && maxPage === 0"}],staticClass:"q-mt-lg q-mb-xl text-h6 text-bold text-center"},[t._v("END")]),a("div",{directives:[{name:"show",rawName:"v-show",value:t.loading,expression:"loading"}],staticClass:"row justify-center q-my-md"},[a("q-spinner-dots",{attrs:{color:"primary",size:"40px"}})],1),a("div",{staticClass:"q-pa-lg flex flex-center"},[a("q-pagination",{directives:[{name:"show",rawName:"v-show",value:t.maxPage,expression:"maxPage"}],attrs:{max:t.maxPage,"max-pages":7,"boundary-numbers":!1},model:{value:t.page,callback:function(e){t.page=e},expression:"page"}})],1),a("div",{directives:[{name:"show",rawName:"v-show",value:"guest"===t.userName,expression:"userName === 'guest'"}],staticClass:"flex flex-center"},[t._v("小提示: 使用 guest 账号加载速度会受到限制，推荐注册属于自己的账号")])],1)],1)])},xt=[],yt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-card",[a("router-link",{attrs:{to:"/work/"+t.metadata.id}},[a("CoverSFW",{attrs:{"cover-url":t.coverUrl,workid:t.metadata.id,nsfw:!1,release:t.metadata.release}})],1),a("q-separator"),t.thumbnailMode?t._e():a("div",[a("div",{staticClass:"q-mx-sm text-h6 text-weight-regular ellipsis-2-lines"},[a("router-link",{staticStyle:{color:"inherit"},attrs:{to:"/work/"+t.metadata.id}},[t._v("\n        "+t._s(t.metadata.title)+"\n      ")])],1),a("div",{staticClass:"q-ml-sm q-mt-sm q-mb-xs text-subtitle1 text-weight-regular ellipsis"},[a("router-link",{staticClass:"text-grey",attrs:{to:"/works?circleId="+t.metadata.circle.id}},[t._v("\n        "+t._s(t.metadata.circle.name)+"\n      ")])],1),a("div",{directives:[{name:"show",rawName:"v-show",value:t.metadata.title,expression:"metadata.title"}],staticClass:"row items-center"},[a("div",{staticClass:"col-auto q-ml-sm"},[a("q-rating",{attrs:{size:"sm",color:t.userMarked?"blue":"amber",icon:"star_border","icon-selected":"star","icon-half":"star_half"},model:{value:t.rating,callback:function(e){t.rating=e},expression:"rating"}}),t.metadata.rate_count_detail?a("q-tooltip",{attrs:{"content-class":"text-subtitle1"}},[a("div",[t._v("平均: "+t._s(t.metadata.rate_average_2dp))]),t._l(t.sortedRatings,(function(e,s){return a("div",{key:s,staticClass:"row items-center"},[a("div",{staticClass:"col"},[t._v(t._s(e.review_point)+"星")]),a("q-linear-progress",{staticClass:"col-auto",staticStyle:{height:"15px",width:"100px"},attrs:{value:e.ratio/100,color:"amber","track-color":"white"}}),a("div",{staticClass:"col q-mx-sm"},[t._v("("+t._s(e.count)+")")])],1)}))],2):t._e()],1),a("div",{staticClass:"col-auto"},[a("span",{staticClass:"text-weight-medium text-body1 text-red"},[t._v(t._s(t.metadata.rate_average_2dp))]),a("span",{staticClass:"text-grey"},[t._v(" ("+t._s(t.metadata.rate_count)+")")])]),a("div",{staticClass:"col-auto q-px-sm"},[a("q-icon",{attrs:{name:"chat",size:"xs"}}),a("span",{staticClass:"text-grey"},[t._v(" ("+t._s(t.metadata.review_count)+")")])],1),a("div",{staticClass:"col-auto"},[a("q-icon",{attrs:{name:"launch",size:"xs"}}),a("a",{staticClass:"text-blue",attrs:{href:"https://www.dlsite.com/home/work/=/product_id/RJ"+String(t.metadata.id).padStart(6,"0")+".html",rel:"noreferrer noopener",target:"_blank"}},[t._v("DLsite")])],1)]),a("div",{directives:[{name:"show",rawName:"v-show",value:t.metadata.title,expression:"metadata.title"}]},[a("span",{staticClass:"q-mx-sm text-weight-medium text-h6 text-red"},[t._v(t._s(t.metadata.price)+" 日元")]),a("span",[t._v("售出数: "+t._s(t.metadata.dl_count))]),t.metadata.nsfw?t._e():a("span",{staticClass:"q-mx-sm",staticStyle:{background:"#e6f7d6",color:"#56842a"}},[t._v("全年龄")]),t.metadata.has_subtitle?a("span",{staticClass:"q-mx-sm",staticStyle:{color:"dodgerblue"}},[t._v("带字幕")]):t._e()]),t.showTags?a("div",{staticClass:"q-ma-xs"},t._l(t.metadata.tags,(function(e,s){return a("router-link",{key:s,attrs:{to:"/works?tagId="+e.id}},[a("q-chip",{staticClass:"shadow-2",attrs:{size:"md"}},[t._v("\n          "+t._s(e.name)+"\n        ")])],1)})),1):t._e(),a("div",{staticClass:"q-mx-xs q-my-sm"},t._l(t.metadata.vas,(function(e,s){return a("router-link",{key:s,attrs:{to:"/works?vaId="+e.id}},[a("q-chip",{staticClass:"shadow-2",attrs:{square:"",size:"md",color:"teal","text-color":"white"}},[t._v("\n          "+t._s(e.name)+"\n        ")])],1)})),1)])],1)},Ct=[],St=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("router-link",{attrs:{to:"/work/"+t.workid}},[a("q-img",{staticStyle:{"max-width":"560px"},attrs:{src:t.coverUrl,ratio:4/3,"img-class":t.imgClass,transition:"fade"},on:{mouseover:function(e){return t.toggleBlurFlag()},mouseout:function(e){return t.toggleBlurFlag()}}},[a("div",{staticClass:"absolute-top-left transparent",staticStyle:{padding:"0"}},[a("q-chip",{staticClass:"q-ma-sm",attrs:{dense:"",square:"",color:"brown","text-color":"white"}},[t._v("\n        "+t._s("RJ"+t.rjcode)+"\n      ")])],1),a("div",{staticClass:"absolute-bottom-right",staticStyle:{padding:"5px"},attrs:{"v-if":t.release}},[t._v("\n      "+t._s(t.release)+"\n    ")])])],1)},Et=[],$t={name:"CoverSFW",props:{coverUrl:{type:String,required:!0},workid:{type:Number,required:!0},nsfw:{type:Boolean,default:!0},release:{required:!0}},data(){return{blurFlag:!0}},computed:{rjcode(){return("000000"+this.workid).slice(-6)},imgClass(){return this.$q.platform.is.mobile?"":this.nsfw&&this.blurFlag?"blur-image":""}},methods:{toggleBlurFlag(){this.blurFlag=!this.blurFlag}}},Tt=$t,Nt=(a("1f5a"),a("068f")),It=a("b047"),Pt=Object(h["a"])(Tt,St,Et,!1,null,null,null),Rt=Pt.exports;G()(Pt,"components",{QImg:Nt["a"],QChip:It["a"]});var Qt=a("c221"),Ot={name:"WorkCard",mixins:[Y["a"]],components:{CoverSFW:Rt},props:{metadata:{type:Object,required:!0},thumbnailMode:{type:Boolean,default:!1}},data(){return{rating:0,userMarked:!1,showTags:!0}},computed:{sortedRatings:function(){function t(t,e){return t.review_point>e.review_point?-1:1}return this.metadata.rate_count_detail.slice().sort(t)},coverUrl:function(){return Object(Qt["a"])(this.metadata,"main")}},mounted(){this.metadata.userRating?(this.userMarked=!0,this.rating=this.metadata.userRating):(this.userMarked=!1,this.rating=this.metadata.rate_average_2dp||0),this.metadata.tags&&null===this.metadata.tags[0].name&&(this.showTags=!1)},watch:{rating(t,e){if(e){const e={user_name:this.$store.state.User.name,work_id:this.metadata.id,rating:t};this.userMarked=!0,this.submitRating(e)}}},methods:{submitRating(t){this.$axios.put("/api/review",t).then(t=>{this.showSuccNotif(t.data.message)}).catch(t=>{t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})}}},Mt=Ot,Ut=a("eb85"),At=a("daf4"),Lt=a("05c0"),Dt=a("6b1d"),jt=Object(h["a"])(Mt,yt,Ct,!1,null,null,null),Wt=jt.exports;G()(jt,"components",{QCard:D["a"],QSeparator:Ut["a"],QRating:At["a"],QTooltip:Lt["a"],QLinearProgress:Dt["a"],QIcon:ot["a"],QChip:It["a"]});var Ft=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-item",{class:t.classBackgroundColor,staticStyle:{padding:"5px"},attrs:{clickable:"",to:"/work/"+t.metadata.id}},[a("q-item-section",{staticStyle:{padding:"0px 5px 0px 0px"},attrs:{avatar:""}},[a("router-link",{attrs:{to:"/work/"+t.metadata.id}},[a("q-img",{staticStyle:{height:"60px",width:"60px"},attrs:{transition:"fade",src:t.samCoverUrl}})],1)],1),a("q-item-section",[a("q-item-label",{staticClass:"text",attrs:{lines:"2"}},[a("router-link",{staticStyle:{color:"inherit"},attrs:{to:"/work/"+t.metadata.id}},[t._v("\n        "+t._s(t.metadata.title)+"\n      ")])],1),a("q-item-label",[a("div",{staticClass:"row q-gutter-x-sm q-gutter-y-xs"},[a("router-link",{staticClass:"col-auto text-grey",attrs:{to:"/works?circleId="+t.metadata.circle.id}},[t._v("\n          "+t._s(t.metadata.circle.name)+"\n        ")]),a("span",{staticClass:"col-auto"},[t._v("/")]),t._l(t.metadata.vas,(function(e,s){return a("router-link",{key:s,staticClass:"col-auto text-primary",attrs:{to:"/works?vaId="+e.id}},[t._v("\n          "+t._s(e.name)+"\n        ")])}))],2)]),t.showLabel&&t.$q.screen.width>700?a("q-item-label",[a("div",{staticClass:"row q-gutter-x-sm q-gutter-y-xs"},t._l(t.metadata.tags,(function(e,s){return a("router-link",{key:s,staticClass:"col-auto text-grey",attrs:{to:"/works?tagId="+e.id}},[t._v("\n          "+t._s(e.name)+"\n        ")])})),1)]):t._e()],1)],1)},Bt=[],zt=a("c1a2"),Gt={name:"WorkListItem",mixins:[zt["a"]],props:{metadata:{type:Object,required:!0},showLabel:{type:Boolean,default:!0}},computed:{samCoverUrl(){return Object(Qt["a"])(this.metadata,"sam")}}},Jt=Gt,Kt=Object(h["a"])(Jt,Ft,Bt,!1,null,null,null),Yt=Kt.exports;G()(Kt,"components",{QItem:dt["a"],QItemSection:ut["a"],QImg:Nt["a"],QItemLabel:pt["a"]});var Ht={name:"Works",mixins:[Y["a"],zt["a"]],components:{WorkCard:Wt,WorkListItem:Yt},data(){return{displayMode:"detail",showLabel:!0,detailMode:!1,stopLoad:!1,loading:!0,works:[],pageTitle:"",page:1,pagination:{currentPage:0,pageSize:12,totalCount:0},seed:7,subtitleOnly:!1,previousUrl:"",sortOption:{label:"发售日期倒序",order:"release",sort:"desc"},options:[{label:"发售日期倒序",order:"release",sort:"desc"},{label:"我的评价倒序",order:"rating",sort:"desc"},{label:"发售日期顺序",order:"release",sort:"asc"},{label:"销量倒序",order:"dl_count",sort:"desc"},{label:"价格顺序",order:"price",sort:"asc"},{label:"价格倒序",order:"price",sort:"desc"},{label:"评价倒序",order:"rate_average_2dp",sort:"desc"},{label:"评论数量倒序",order:"review_count",sort:"desc"},{label:"RJ号倒序",order:"id",sort:"desc"},{label:"RJ号顺序",order:"id",sort:"asc"},{label:"全年龄顺序",order:"nsfw",sort:"asc"},{label:"随机排序",order:"random",sort:"desc"}]}},created(){this.refreshPageTitle(),this.seed=Math.floor(100*Math.random())},mounted(){if(localStorage.sortOption)try{let t=JSON.parse(localStorage.sortOption);this.sortOption=this.options.find(e=>t.order===e.order&&t.sort===e.sort)}catch{localStorage.removeItem("sortOption")}localStorage.displayMode&&(this.displayMode=localStorage.displayMode),this.requestWorksQueue()},computed:{...Object(v["d"])("User",{userName:"name"}),maxPage(){return Math.ceil(this.pagination.totalCount/this.pagination.pageSize)},url(){const t=this.$route.query;return t.circleId?`/api/circles/${this.$route.query.circleId}/works`:t.tagId?`/api/tags/${this.$route.query.tagId}/works`:t.vaId?`/api/vas/${this.$route.query.vaId}/works`:t.keyword?"/api/search/"+t.keyword:"/api/works"}},activated(){this.stopLoad=!1},deactivated(){this.stopLoad=!0},watch:{url(t,e){let a=!this.$route.path.startsWith("/works"),s=this.previousUrl===e;a||s||(this.previousUrl=e,this.reset())},sortOption(t,e){console.log(`Sort option changed! old: ${JSON.stringify(e)}, new: ${JSON.stringify(t)}`),JSON.stringify(e)!==JSON.stringify(t)&&(localStorage.sortOption=JSON.stringify(t),this.seed=Math.floor(100*Math.random()),this.reset())},subtitleOnly(){this.reset()},showLabel(t){localStorage.showLabel=t},listMode(t){localStorage.listMode=t},detailMode(t){localStorage.detailMode=t},page(){document.getElementById("gotop")&&document.getElementById("gotop").click(),this.requestWorksQueue()}},methods:{requestWorksQueue(){this.loading=!0,this.works={};const t={order:this.sortOption.order,sort:this.sortOption.sort,page:this.page,seed:this.seed,subtitle:this.subtitleOnly?1:0};return this.$axios.get(this.url,{params:t}).then(t=>{this.loading=!1;const e=t.data.works;this.works=e.concat(),this.pagination=t.data.pagination,this.works.length>=this.pagination.totalCount&&(this.stopLoad=!0)}).catch(t=>{this.loading=!1,t.response?401!==t.response.status&&this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t),this.stopLoad=!0})},refreshPageTitle(){if(this.$route.query.circleId||this.$route.query.tagId||this.$route.query.vaId){let t="",e="";this.$route.query.circleId?(e="circles",t=`/api/${e}/${this.$route.query.circleId}`):this.$route.query.tagId?(e="tags",t=`/api/${e}/${this.$route.query.tagId}`):(e="vas",t=`/api/${e}/${this.$route.query.vaId}`),this.$axios.get(t).then(t=>{const a=t.data.name;let s;switch(e){case"tags":s="Works tagged with ";break;case"vas":s="Works voiced by ";break;case"circles":s="Works by ";break}s+=a||"",this.pageTitle=s}).catch(t=>{t.response?401!==t.response.status&&this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})}else this.$route.query.keyword?this.pageTitle="Search by "+this.$route.query.keyword:this.pageTitle="All works"},reset(){this.stopLoad=!1,this.refreshPageTitle(),this.pagination={currentPage:0,pageSize:12,totalCount:0},1===this.page?this.requestWorksQueue():this.page=1}}},Vt=Ht,Xt=(a("dd50"),a("ef35")),Zt=a("ddd8"),te=a("8f8e"),ee=a("6a67"),ae=a("8380"),se=a("3b16"),re=Object(h["a"])(Vt,kt,xt,!1,null,"072ab40d",null),ie=re.exports;G()(re,"components",{QInfiniteScroll:Xt["a"],QPage:wt["a"],QSelect:Zt["a"],QCheckbox:te["a"],QBtnToggle:ee["a"],QList:ct["a"],QSpinnerDots:ae["a"],QPagination:se["a"]});var oe=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("WorkDetails",{attrs:{metadata:t.metadata},on:{reset:function(e){return t.requestData()}}}),a("WorkTree",{attrs:{tree:t.tree,editable:!1}})],1)},ne=[],le=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("router-link",{attrs:{to:"/work/"+t.metadata.id}},[a("CoverSFW",{attrs:{"cover-url":t.coverUrl,workid:t.metadata.id,nsfw:!1,release:t.metadata.release}})],1),a("div",{staticClass:"q-pa-sm"},[a("div",{staticClass:"q-px-sm q-py-none"},[a("div",{staticClass:"text-h6 text-weight-regular"},[a("router-link",{class:t.classTextColor,attrs:{to:"/work/"+t.metadata.id}},[t._v("\n          "+t._s(t.metadata.title)+"\n        ")])],1),a("div",{staticClass:"text-subtitle1 text-weight-regular"},[a("router-link",{staticClass:"text-grey",attrs:{to:"/works?circleId="+t.metadata.circle.id}},[t._v("\n          "+t._s(t.metadata.circle.name)+"\n        ")])],1),a("div",{staticClass:"row items-center q-gutter-xs"},[a("div",{staticClass:"col-auto"},[a("q-rating",{attrs:{name:"rating",size:"sm",color:t.userMarked?"blue":"amber",icon:"star_border","icon-selected":"star","icon-half":"star_half"},on:{input:t.setRating},model:{value:t.rating,callback:function(e){t.rating=e},expression:"rating"}}),t.metadata.rate_count_detail?a("q-tooltip",{attrs:{"content-class":"text-subtitle1"}},[a("div",[t._v("平均: "+t._s(t.metadata.rate_average_2dp))]),t._l(t.sortedRatings,(function(e,s){return a("div",{key:s,staticClass:"row items-center"},[a("div",{staticClass:"col"},[t._v(" "+t._s(e.review_point)+"星 ")]),a("q-linear-progress",{staticClass:"col-auto",staticStyle:{height:"15px",width:"100px"},attrs:{value:e.ratio/100,color:"amber","track-color":"white"}}),a("div",{staticClass:"col q-mx-sm"},[t._v(" ("+t._s(e.count)+") ")])],1)}))],2):t._e()],1),a("div",{staticClass:"col-auto"},[a("span",{staticClass:"text-weight-medium text-body1 text-red"},[t._v(t._s(t.metadata.rate_average_2dp))]),a("span",{staticClass:"text-grey"},[t._v(" ("+t._s(t.metadata.rate_count)+")")])]),a("div",{staticClass:"col-auto q-px-sm"},[a("q-icon",{attrs:{name:"chat",size:"xs"}}),a("span",{staticClass:"text-grey"},[t._v(" ("+t._s(t.metadata.review_count)+")")])],1),a("div",{staticClass:"col-auto"},[a("q-icon",{attrs:{name:"launch",size:"xs"}}),a("a",{staticClass:"text-blue",attrs:{href:"https://www.dlsite.com/home/work/=/product_id/RJ"+String(t.metadata.id).padStart(6,"0")+".html",rel:"noreferrer noopener",target:"_blank"}},[t._v("DLsite")])],1)])]),a("div",{staticClass:"q-pt-sm q-pb-none"},[a("span",{staticClass:"q-mx-sm text-weight-medium text-h6 text-red"},[t._v(t._s(t.metadata.price)+" 日元")]),t._v(" 售出数: "+t._s(t.metadata.dl_count)+"\n    ")]),t.showTags?a("div",{staticClass:"q-px-none q-py-sm"},t._l(t.metadata.tags,(function(e,s){return a("router-link",{key:s,attrs:{to:"/works?tagId="+e.id}},[a("q-chip",{staticClass:"shadow-4",attrs:{size:"md"}},[t._v("\n          "+t._s(e.name)+"\n        ")])],1)})),1):t._e(),a("div",{staticClass:"q-px-none q-pt-sm q-py-sm"},t._l(t.metadata.vas,(function(e,s){return a("router-link",{key:s,attrs:{to:"/works?vaId="+e.id}},[a("q-chip",{staticClass:"shadow-4",attrs:{square:"",size:"md",color:"teal","text-color":"white"}},[t._v("\n          "+t._s(e.name)+"\n        ")])],1)})),1),a("q-btn-dropdown",{staticClass:"q-mt-sm shadow-4 q-mx-xs q-pl-sm",attrs:{dense:"",color:"cyan",label:"标记进度"}},[a("q-list",[a("q-item",{staticClass:"q-pa-xs",attrs:{clickable:""},on:{click:function(e){return t.setProgress("marked")}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-avatar",{directives:[{name:"show",rawName:"v-show",value:"marked"===t.progress,expression:"progress === 'marked'"}],attrs:{icon:"headset"}})],1),a("q-item-section",[a("q-item-label",[t._v("想听")])],1)],1),a("q-item",{staticClass:"q-pa-xs",attrs:{clickable:""},on:{click:function(e){return t.setProgress("listening")}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-avatar",{directives:[{name:"show",rawName:"v-show",value:"listening"===t.progress,expression:"progress === 'listening'"}],attrs:{icon:"headset"}})],1),a("q-item-section",[a("q-item-label",[t._v("在听")])],1)],1),a("q-item",{staticClass:"q-pa-xs",attrs:{clickable:""},on:{click:function(e){return t.setProgress("listened")}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-avatar",{directives:[{name:"show",rawName:"v-show",value:"listened"===t.progress,expression:"progress === 'listened'"}],attrs:{icon:"headset"}})],1),a("q-item-section",[a("q-item-label",[t._v("听过")])],1)],1),a("q-item",{staticClass:"q-pa-xs",attrs:{clickable:""},on:{click:function(e){return t.setProgress("replay")}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-avatar",{directives:[{name:"show",rawName:"v-show",value:"replay"===t.progress,expression:"progress === 'replay'"}],attrs:{icon:"headset"}})],1),a("q-item-section",[a("q-item-label",[t._v("重听")])],1)],1),a("q-item",{staticClass:"q-pa-xs",attrs:{clickable:""},on:{click:function(e){return t.setProgress("postponed")}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-avatar",{directives:[{name:"show",rawName:"v-show",value:"postponed"===t.progress,expression:"progress === 'postponed'"}],attrs:{icon:"headset"}})],1),a("q-item-section",[a("q-item-label",[t._v("搁置")])],1)],1)],1)],1),a("q-btn",{attrs:{dense:"",color:"cyan q-mt-sm shadow-4 q-mx-xs q-px-sm",label:"写评论"},on:{click:function(e){t.showReviewDialog=!0}}}),t.showReviewDialog?a("WriteReview",{attrs:{workid:t.metadata.id,metadata:t.metadata},on:{closed:t.processReview}}):t._e()],1)],1)},ce=[],de=a("c16d"),ue={name:"WorkDetails",mixins:[Y["a"],zt["a"]],components:{CoverSFW:Rt,WriteReview:de["a"]},props:{metadata:{type:Object,required:!0}},data(){return{rating:0,userMarked:!1,progress:"",showReviewDialog:!1,showTags:!0}},computed:{sortedRatings:function(){function t(t,e){return t.review_point>e.review_point?-1:1}return this.metadata.rate_count_detail.slice().sort(t)},coverUrl:function(){return Object(Qt["a"])(this.metadata,"main")}},watch:{metadata(t){t.userRating?(this.userMarked=!0,this.rating=t.userRating):(this.userMarked=!1,this.rating=t.rate_average_2dp||0),this.progress=t.progress,t.tags&&null===t.tags[0].name&&(this.showTags=!1)}},methods:{setProgress(t){this.progress=t;const e={user_name:this.$store.state.User.name,work_id:this.metadata.id,progress:t};this.submitProgress(e)},submitProgress(t){const e={starOnly:!1,progressOnly:!0};this.$axios.put("/api/review",t,{params:e}).then(t=>{this.showSuccNotif(t.data.message),this.$emit("reset")}).catch(t=>{t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})},setRating(t){const e={user_name:this.$store.state.User.name,work_id:this.metadata.id,rating:t};this.submitRating(e)},submitRating(t){this.$axios.put("/api/review",t).then(t=>{this.showSuccNotif(t.data.message),this.$emit("reset")}).catch(t=>{t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})},processReview(){this.showReviewDialog=!1}},mounted(){this.$store.commit("AudioPlayer/LOAD_PLAYER")}},pe=ue,me=a("f20b"),he=Object(h["a"])(pe,le,ce,!1,null,null,null),ge=he.exports;G()(he,"components",{QRating:At["a"],QTooltip:Lt["a"],QLinearProgress:Dt["a"],QIcon:ot["a"],QChip:It["a"],QBtnDropdown:me["a"],QList:ct["a"],QItem:dt["a"],QItemSection:ut["a"],QAvatar:ht["a"],QItemLabel:pt["a"],QBtn:F["a"]});var we=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"q-ma-md "},[t.path.length?a("q-breadcrumbs",{attrs:{gutter:"xs"}},[a("q-breadcrumbs-el",[a("q-btn",{staticStyle:{height:"30px"},attrs:{"no-caps":"",flat:"",dense:"",size:"md",icon:"folder"},on:{click:function(e){t.path=[]}}},[t._v("ROOT")])],1),t._l(t.path,(function(e,s){return a("q-breadcrumbs-el",{key:s,staticClass:"cursor-pointer"},[a("q-btn",{staticStyle:{height:"30px"},attrs:{"no-caps":"",flat:"",dense:"",size:"md",icon:"folder"},on:{click:function(e){return t.onClickBreadcrumb(s)}}},[t._v(t._s(e))])],1)}))],2):t._e(),a("q-card",[a("q-list",{attrs:{separator:""}},t._l(t.fatherFolder,(function(e,s){return a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:s,staticClass:"non-selectable",attrs:{clickable:"",active:"audio"===e.type&&t.currentPlayingFile.hash===e.hash,"active-class":"text-white bg-teal"},on:{click:function(a){return t.onClickItem(e)}}},[a("q-item-section",{attrs:{avatar:""}},["folder"===e.type?a("q-icon",{attrs:{size:"34px",color:"amber",name:"folder"}}):"text"===e.type?a("q-icon",{attrs:{size:"34px",color:"info",name:"description"}}):"image"===e.type?a("q-icon",{attrs:{size:"34px",color:"orange",name:"photo"}}):"other"===e.type?a("q-icon",{attrs:{size:"34px",color:"info",name:"description"}}):a("q-btn",{attrs:{round:"",dense:"",color:"primary",icon:t.playIcon(e.hash)},on:{click:function(a){return t.onClickPlayButton(e.hash)}}})],1),a("q-item-section",[a("q-item-label",{attrs:{lines:"2"}},[t._v(t._s(e.title))]),e.children?a("q-item-label",{attrs:{caption:"",lines:"1"}},[t._v(t._s(e.children.length+" 项目"))]):t._e()],1),"audio"===e.type||"text"===e.type||"image"===e.type||"other"===e.type?a("q-menu",{attrs:{"touch-position":"","context-menu":"","auto-close":"","transition-show":"jump-down","transition-hide":"jump-up"}},[a("q-list",{attrs:{separator:""}},["audio"===e.type?a("q-item",{attrs:{clickable:""},on:{click:function(a){return t.addToQueue(e)}}},[a("q-item-section",[t._v("添加到播放列表")])],1):t._e(),"audio"===e.type?a("q-item",{attrs:{clickable:""},on:{click:function(a){return t.playNext(e)}}},[a("q-item-section",[t._v("下一曲播放")])],1):t._e(),a("q-item",{attrs:{clickable:""},on:{click:function(a){return t.download(e)}}},[a("q-item-section",[t._v("下载文件")])],1)],1)],1):t._e()],1)})),1)],1)],1)},ve=[],fe={name:"WorkTree",data(){return{path:[]}},props:{tree:{type:Array,required:!0}},watch:{tree(){this.initPath()}},computed:{fatherFolder(){let t=this.tree.concat();return this.path.forEach(e=>{t=t.find(t=>"folder"===t.type&&t.title===e).children}),t},queue(){const t=[];return this.fatherFolder.forEach(e=>{"audio"===e.type&&t.push(e)}),t},...Object(v["d"])("AudioPlayer",["playing"]),...Object(v["b"])("AudioPlayer",["currentPlayingFile"])},methods:{playIcon(t){return this.playing&&this.currentPlayingFile.hash===t?"pause":"play_arrow"},initPath(){const t=[];let e=this.tree.concat();while(1===e.length){if("audio"===e[0].type)break;t.push(e[0].title),e=e[0].children}this.path=t},onClickBreadcrumb(t){this.path=this.path.slice(0,t+1)},onClickItem(t){"folder"===t.type?this.path.push(t.title):"text"===t.type||"image"===t.type?this.openFile(t):"other"===t.type?this.download(t):this.currentPlayingFile.hash!==t.hash&&this.$store.commit("AudioPlayer/SET_QUEUE",{queue:this.queue.concat(),index:this.queue.findIndex(e=>e.hash===t.hash),resetPlaying:!0})},onClickPlayButton(t){this.currentPlayingFile.hash===t?this.$store.commit("AudioPlayer/TOGGLE_WANT_PLAYING"):this.$store.commit("AudioPlayer/SET_QUEUE",{queue:this.queue.concat(),index:this.queue.findIndex(e=>e.hash===t),resetPlaying:!0})},addToQueue(t){this.$store.commit("AudioPlayer/ADD_TO_QUEUE",t)},playNext(t){this.$store.commit("AudioPlayer/PLAY_NEXT",t)},download(t){const e=this.$q.localStorage.getItem("jwt-token")||"",a=t.mediaDownloadUrl?`${t.mediaDownloadUrl}?token=${e}`:Object(Qt["b"])(t.hash,e),s=document.createElement("a");s.href=a,s.target="_blank",s.click()},openFile(t){const e=this.$q.localStorage.getItem("jwt-token")||"",a=t.mediaStreamUrl?`${t.mediaStreamUrl}?token=${e}`:Object(Qt["c"])(t.hash,e),s=document.createElement("a");s.href=a,s.target="_blank",s.click()}}},be=fe,qe=a("ead5"),_e=a("079e"),ke=a("4e73"),xe=Object(h["a"])(be,we,ve,!1,null,null,null),ye=xe.exports;G()(xe,"components",{QBreadcrumbs:qe["a"],QBreadcrumbsEl:_e["a"],QBtn:F["a"],QCard:D["a"],QList:ct["a"],QItem:dt["a"],QItemSection:ut["a"],QIcon:ot["a"],QItemLabel:pt["a"],QMenu:ke["a"]}),G()(xe,"directives",{Ripple:bt["a"]});var Ce={name:"Work",mixins:[Y["a"]],components:{WorkDetails:ge,WorkTree:ye},data(){return{workid:this.$route.params.id,metadata:{id:parseInt(this.$route.params.id),circle:{}},tree:[]}},watch:{$route(t){this.workid=t.params.id,this.requestData()}},created(){this.requestData()},methods:{requestData(){this.$axios.get("/api/work/"+this.workid).then(t=>{this.metadata=t.data}).catch(t=>{t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)}),this.$axios.get("/api/tracks/"+this.workid).then(t=>{this.tree=t.data}).catch(t=>{t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})}}},Se=Ce,Ee=Object(h["a"])(Se,oe,ne,!1,null,null,null),$e=Ee.exports,Te=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-form",{staticClass:"absolute-center\tq-gutter-md",staticStyle:{width:"260px"},on:{submit:t.onSubmit}},[a("q-input",{staticClass:"fit",attrs:{filled:"",label:"用户名","lazy-rules":"",rules:[function(t){return t&&t.length>=5||"用户名长度至少为 5"}]},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}),a("q-input",{staticClass:"fit",attrs:{filled:"",type:"password",label:"密码","lazy-rules":"",rules:[function(t){return t&&t.length>=5||"密码长度至少为 5"}],clearable:""},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}}),t.showRegisterForm?a("q-input",{staticClass:"fit",attrs:{filled:"",type:"password",label:"请再次输入密码","lazy-rules":"","bottom-slots":"",rules:[function(e){return e&&e===t.password||"两次密码必须一致"}],clearable:""},model:{value:t.passwordConfirm,callback:function(e){t.passwordConfirm=e},expression:"passwordConfirm"}}):t._e(),this.$store.state.User.reg&&!t.showRegisterForm?a("q-btn",{staticClass:"fit",attrs:{label:"注册",color:"secondary"},on:{click:t.navigateToRegister}}):t._e(),t.showRegisterForm?t._e():a("q-btn",{staticClass:"fit",attrs:{label:"登录",type:"submit",color:"primary"}}),t.showRegisterForm?a("q-btn",{staticClass:"fit",attrs:{label:"去看看！",type:"submit",color:"secondary"}}):t._e(),t.showRegisterForm?a("q-btn",{staticClass:"fit",attrs:{label:"返回",color:"primary"},on:{click:t.navigateBack}}):t._e()],1)},Ne=[],Ie=a("bc3a"),Pe=a.n(Ie);function Re(t){Pe.a.defaults.headers["Authorization"]="Bearer "+t}Pe.a.defaults.headers["Content-Type"]="application/json",Pe.a.defaults.headers["Authorization"]=n["a"].getItem("jwt-token")?"Bearer "+n["a"].getItem("jwt-token"):"",Pe.a.defaults.baseURL=H["a"],s["a"].prototype.$axios=Pe.a;var Qe={mixins:[Y["a"]],data(){return{name:"",password:"",passwordConfirm:"",showRegisterForm:!1}},mounted(){this.checkRegEnable()},methods:{navigateToRegister(){this.showRegisterForm=!0},navigateBack(){this.showRegisterForm=!1},onSubmit(){this.showRegisterForm?this.reg():this.login()},checkRegEnable(){this.$axios.get("/api/auth/reg").then(t=>{this.$store.commit("User/SET_REG",t.data.reg)})},login(){let t=this.$axios.post("/api/auth/me",{name:this.name,password:this.password});this.handleResponse(t,"login")},reg(){let t=this.$axios.post("/api/auth/reg",{name:this.name,password:this.password});this.handleResponse(t,"reg")},handleResponse(t,e){t.then(t=>{try{this.$q.localStorage.set("jwt-token",t.data.token),Re(t.data.token),this.showSuccNotif("reg"===e?"注册成功.":"登录成功."),this.$router.push("/")}catch(a){this.showErrNotif(a.message)}}).catch(t=>{t.response?401===t.response.status?this.showWarnNotif(t.response.data.error):this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})}}},Oe=Qe,Me=a("0378"),Ue=Object(h["a"])(Oe,Te,Ne,!1,null,null,null),Ae=Ue.exports;function Le(t,e){return e.map(e=>(e.path=t+""+e.path,e))}G()(Ue,"components",{QForm:Me["a"],QInput:it["a"],QBtn:F["a"]});const De=[{path:"/admin",component:()=>a.e(7).then(a.bind(null,"8265")),children:[{path:"",component:()=>a.e(13).then(a.bind(null,"9ad9"))},{path:"scanner",component:()=>Promise.all([a.e(1),a.e(14)]).then(a.bind(null,"7ca0"))},{path:"advanced",component:()=>Promise.all([a.e(1),a.e(12)]).then(a.bind(null,"1e24"))},{path:"usermanage",component:()=>Promise.all([a.e(1),a.e(15)]).then(a.bind(null,"09ef"))}]},{path:"/",component:_t,children:[{path:"",redirect:{name:"works"}},{path:"works",name:"works",component:ie},{path:"work/:id",component:$e},{path:"circles",props:{restrict:"circles"},component:()=>a.e(2).then(a.bind(null,"e00c"))},{path:"tags",props:{restrict:"tags"},component:()=>a.e(2).then(a.bind(null,"e00c"))},{path:"vas",props:{restrict:"vas"},component:()=>a.e(2).then(a.bind(null,"e00c"))},{path:"about",props:{restrict:"about"},component:()=>a.e(8).then(a.bind(null,"a1d1"))},...Le("favourites",[{path:"",props:{route:"review"},component:()=>a.e(0).then(a.bind(null,"ddf4"))},{path:"/review",props:{route:"review"},component:()=>a.e(0).then(a.bind(null,"ddf4"))},...Le("/progress",[{path:"",props:{route:"progress",progress:"marked"},component:()=>a.e(0).then(a.bind(null,"ddf4"))},{path:"/marked",props:{route:"progress",progress:"marked"},component:()=>a.e(0).then(a.bind(null,"ddf4"))},{path:"/listening",props:{route:"progress",progress:"listening"},component:()=>a.e(0).then(a.bind(null,"ddf4"))},{path:"/listened",props:{route:"progress",progress:"listened"},component:()=>a.e(0).then(a.bind(null,"ddf4"))},{path:"/replay",props:{route:"progress",progress:"replay"},component:()=>a.e(0).then(a.bind(null,"ddf4"))},{path:"/postponed",props:{route:"progress",progress:"postponed"},component:()=>a.e(0).then(a.bind(null,"ddf4"))}]),{path:"/folder",props:{route:"folder"},component:()=>a.e(0).then(a.bind(null,"ddf4"))}])],meta:{auth:!0}},{path:"/login",component:Ae}];De.push({path:"*",component:()=>a.e(9).then(a.bind(null,"e51e"))});var je=De;s["a"].use(P["a"]);var We=function(){const t=new P["a"]({scrollBehavior(t,e,a){return a||{x:0,y:0}},routes:je,mode:"history",base:"/"});return t},Fe=async function(){const t="function"===typeof I?await I({Vue:s["a"]}):I,e="function"===typeof We?await We({Vue:s["a"],store:t}):We;t.$router=e;const a={router:e,store:t,render:t=>t(w),el:"#q-app"};return{app:a,store:t,router:e}};async function Be(){const{app:t,store:e,router:a}=await Fe();let r=!0;const i=t=>{r=!1,window.location.href=t},o=window.location.href.replace(window.location.origin,""),n=[void 0];for(let c=0;!0===r&&c<n.length;c++)if("function"===typeof n[c])try{await n[c]({app:t,router:a,store:e,Vue:s["a"],ssrContext:null,redirect:i,urlPath:o})}catch(l){return l&&l.url?void(window.location.href=l.url):void console.error("[Quasar] boot error:",l)}!1!==r&&new s["a"](t)}Be()},"31cd":function(t,e,a){},"49f7":function(t,e,a){"use strict";var s=a("70fd"),r=a.n(s);r.a},"6a18":function(t,e){},"70fd":function(t,e,a){},"89d3":function(t,e,a){"use strict";var s=a("e87e"),r=a.n(s);r.a},"8e3b":function(t,e,a){},9224:function(t){t.exports=JSON.parse('{"b":"1.0.3","a":""}')},b5fb:function(t,e){},c16d:function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("q-dialog",{on:{hide:t.closeDialog},model:{value:t.showReviewDialog,callback:function(e){t.showReviewDialog=e},expression:"showReviewDialog"}},[a("q-card",[a("q-card-section",{staticClass:"q-pb-sm"},[a("div",{staticClass:"text-body1"},[t._v("我的评论")])]),a("q-card-section",{staticClass:"q-pt-none"},[a("q-rating",{staticClass:"col-auto",attrs:{size:"sm",color:"blue",icon:"star_border","icon-selected":"star","icon-half":"star_half"},model:{value:t.rating,callback:function(e){t.rating=e},expression:"rating"}}),a("q-btn-toggle",{class:t.$q.screen.lt.sm?"my-custom-toggle q-mx-none q-mt-sm":"my-custom-toggle q-mx-md",attrs:{"no-caps":"",rounded:"",unelevated:"",padding:t.$q.screen.width<400?"sm":"","toggle-color":"primary",color:"white","text-color":"primary",options:[{label:"想听",value:"marked"},{label:"在听",value:"listening"},{label:"听过",value:"listened"},{label:"重听",value:"replay"},{label:"搁置",value:"postponed"}]},model:{value:t.progress,callback:function(e){t.progress=e},expression:"progress"}})],1),a("q-card-section",{staticClass:"q-pt-none"},[a("div",{staticStyle:{"min-width":"300px"}},[a("q-input",{attrs:{filled:"",type:"textarea"},model:{value:t.reviewText,callback:function(e){t.reviewText=e},expression:"reviewText"}})],1)]),a("div",{staticClass:"row justify-between"},[a("q-card-actions",{staticClass:"text-red"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"删除标记"},on:{click:function(e){t.deleteConfirm=!0}}})],1),a("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"确定"},on:{click:function(e){return t.submitReview()}}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消"},on:{click:function(e){return t.closeDialog()}}})],1)],1)],1)],1),a("q-dialog",{attrs:{persistent:"","transition-show":"scale","transition-hide":"scale"},model:{value:t.deleteConfirm,callback:function(e){t.deleteConfirm=e},expression:"deleteConfirm"}},[a("q-card",{staticClass:"bg-teal text-white",staticStyle:{width:"300px"}},[a("q-card-section",[a("div",{staticClass:"text-h6"},[t._v("确定要删除标记吗")])]),a("q-card-actions",{staticClass:"bg-white text-teal",attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"确定"},on:{click:function(e){return t.deleteReview()}}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消"},on:{click:function(e){return t.closeDialog()}}})],1)],1)],1)],1)},r=[],i=a("2d97"),o={name:"WriteReview",mixins:[i["a"]],props:{workid:{type:Number,required:!0},metadata:{type:Object,default:null}},data(){return{showReviewDialog:!0,deleteConfirm:!1,rating:0,reviewText:"",modified:!1,progress:""}},mounted(){this.metadata.userRating&&(this.rating=this.metadata.userRating),this.progress=this.metadata.progress,this.reviewText=this.metadata.review_text},methods:{closeDialog(){this.deleteConfirm||(this.modified?this.$emit("closed",!0):this.$emit("closed",!1))},reviewPayload(){const t={user_name:this.$store.state.User.name,work_id:this.workid,rating:this.rating,review_text:this.reviewText,progress:this.progress};return t},submitReview(){const t={starOnly:!1},e=this.reviewPayload();this.$axios.put("/api/review",e,{params:t}).then(t=>{this.modified=!0,this.showSuccNotif(t.data.message)}).then(()=>this.closeDialog()).catch(t=>{t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})},deleteReview(){const t={work_id:this.workid};this.$axios.delete("/api/review",{params:t}).then(t=>{this.modified=!0,this.showSuccNotif(t.data.message)}).then(()=>this.closeDialog()).catch(t=>{t.response?this.showErrNotif(t.response.data.error||`${t.response.status} ${t.response.statusText}`):this.showErrNotif(t.message||t)})}}},n=o,l=(a("49f7"),a("2877")),c=a("24e8"),d=a("f09f"),u=a("a370"),p=a("daf4"),m=a("6a67"),h=a("27f9"),g=a("4b7e"),w=a("9c40"),v=a("7f67"),f=a("eebe"),b=a.n(f),q=Object(l["a"])(n,s,r,!1,null,"4c36ab3c",null);e["a"]=q.exports;b()(q,"components",{QDialog:c["a"],QCard:d["a"],QCardSection:u["a"],QRating:p["a"],QBtnToggle:m["a"],QInput:h["a"],QCardActions:g["a"],QBtn:w["a"]}),b()(q,"directives",{ClosePopup:v["a"]})},c1a2:function(t,e,a){"use strict";e["a"]={computed:{color(){return this.$q.dark.isActive?"black":"white"},textColor(){return this.$q.dark.isActive?"white":"black"},classTextColor(){return this.$q.dark.isActive?"text-white":"text-black"},classBackgroundColor(){return this.$q.dark.isActive?"bg-black":"bg-white"}}}},c221:function(t,e,a){"use strict";a.d(e,"a",(function(){return r})),a.d(e,"c",(function(){return i})),a.d(e,"b",(function(){return o}));var s=a("9224");const r=(t,e="main")=>{if(t=t||{samCoverUrl:"",thumbnailCoverUrl:"",mainCoverUrl:""},!t.id&&!t.hash.split("/")[0])return"";switch(e){case"main":return t.mainCoverUrl?t.mainCoverUrl:s["a"]+`/api/cover/${t.id||t.hash.split("/")[0]}.jpg?type=main`;case"sam":return t.samCoverUrl?t.samCoverUrl:s["a"]+`/api/cover/${t.id||t.hash.split("/")[0]}.jpg?type=sam`;case"thumb":return t.thumbnailCoverUrl?t.thumbnailCoverUrl:s["a"]+`/api/cover/${t.id||t.hash.split("/")[0]}.jpg?type=240x240`;default:return s["a"]+`/api/cover/${t.id||t.hash.split("/")[0]}.jpg?type=${e}`}},i=(t,e)=>s["a"]+`/api/media/stream/${t}?token=${e}`,o=(t,e)=>s["a"]+`/api/media/download/${t}?token=${e}`},dd50:function(t,e,a){"use strict";var s=a("06e0"),r=a.n(s);r.a},e87e:function(t,e,a){}},[[0,4,1]]]);